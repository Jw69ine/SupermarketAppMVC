<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Checkout & Invoice</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"/>
    <%- include('partials/navbar', { user: user }) %>
    <style>
        body { background: #f4f7fa; }
        .invoice-header {
            background: linear-gradient(90deg, #e3f0fa 0, #f7fafe 100%);
            padding: 2rem 2rem 1.25rem 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 18px rgba(0,0,0,0.07);
        }
        .invoice-summary, .payment-section {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 18px rgba(0,0,0,0.10);
        }
        .invoice-summary {
            margin-bottom: 2.5rem;
            padding: 2rem 1.5rem 1rem 1.5rem;
        }
        .payment-section {
            padding: 2.3rem 2rem 2rem 2rem;
        }
        .invoice-table td, .invoice-table th {
            vertical-align: middle !important;
        }
        .right { text-align: right; }
        .section-title { color: #235fa4; font-weight: 700; }
        .form-label { font-weight: 600; }
        .form-control, .form-select { border-radius: 12px; }
        .btn { border-radius: 8px; }
        .btn-success { font-size: 1.12rem; padding: 0.7rem 1.8rem; }
        .btn-secondary { padding: 0.7rem 1.5rem; }
        .fade-in {
            animation: fadeIn 0.45s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px);}
            to { opacity: 1; transform: none;}
        }
    </style>
</head>
<body>
<div class="container my-5">

    <!-- INVOICE HEADER -->
    <div class="invoice-header d-flex justify-content-between align-items-center mb-4 fade-in">
        <div>
            <h2 class="mb-1 section-title">Supermarket Invoice</h2>
            <p class="mb-0 small text-secondary">
                Invoice #: <strong>INV-<%= Date.now() %></strong><br>
                Date: <strong><%= new Date().toLocaleDateString() %></strong>
            </p>
        </div>
        <div>
            <div class="text-end small">
                <strong>Billed to:</strong><br>
                <span><%= user.username %> (<%= user.email %>)</span>
            </div>
        </div>
    </div>

    <!-- INVOICE SUMMARY TABLE -->
    <div class="invoice-summary mb-4 fade-in">
        <table class="table invoice-table align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th>Product</th>
                    <th>Unit Price</th>
                    <th>Quantity</th>
                    <th class="right">Line Total</th>
                </tr>
            </thead>
            <tbody>
                <% cart.forEach(item => { %>
                <tr>
                    <td><%= item.productName %></td>
                    <td>$<%= Number(item.price).toFixed(2) %></td>
                    <td><%= item.quantity %></td>
                    <td class="right fw-semibold">$<%= (item.price * item.quantity).toFixed(2) %></td>
                </tr>
                <% }) %>
            </tbody>
            <tfoot>
                <tr class="table-light">
                    <td colspan="3" class="right fw-bold fs-5">Subtotal</td>
                    <td class="right fw-bold fs-5">$<%= Number(total).toFixed(2) %></td>
                </tr>
            </tfoot>
        </table>
    </div>

    <!-- PAYMENT SECTION -->
    <div class="payment-section shadow-sm fade-in">
        <h4 class="mb-4 section-title">Payment</h4>
        <form action="/checkout/confirm" method="POST" enctype="multipart/form-data" autocomplete="off">
            <div class="mb-4">
                <label for="paymentMethod" class="form-label">Payment Method</label>
                <select name="paymentMethod" id="paymentMethod" class="form-select form-select-lg" required>
                    <option value="Card">Credit/Debit Card</option>
                    <option value="Crypto">Cryptocurrency</option>
                    <option value="BankTransfer">Bank Transfer</option>
                </select>
            </div>

            <!-- Card Fields -->
            <div id="cardFields" style="display:none">
                <input type="text" name="cardName" placeholder="Cardholder Name" class="form-control form-control-lg mb-3" />
                <input type="text" name="cardNumber" placeholder="Card Number" class="form-control form-control-lg mb-3" maxlength="20"/>
                <input type="text" name="cardExpiry" placeholder="Expiry (MM/YY)" class="form-control form-control-lg mb-3" maxlength="5"/>
                <input type="text" name="cardCVC" placeholder="CVC" class="form-control form-control-lg mb-3" maxlength="4"/>
            </div>

            <!-- Crypto Fields -->
            <div id="cryptoFields" style="display:none">
                <div class="mb-2">
                    <label class="form-label text-primary">Pay to this address: <span class="fw-bold">0xDEADBEEF...</span></label>
                </div>
                <input type="text" name="cryptoTxId" placeholder="Your transaction ID (optional for mock)" class="form-control form-control-lg mb-3" />
            </div>

            <!-- Bank Fields -->
            <div id="bankFields" style="display:none">
                <div class="mb-2">
                    <label class="form-label text-primary">Transfer to: <span class="fw-bold">Bank XYZ, #123-456-789</span></label>
                </div>
                <input type="file" name="bankScreenshot" class="form-control form-control-lg mb-2" />
                <small class="text-muted ms-1">Upload screenshot of transfer/receipt.</small>
            </div>

            <div class="d-flex mt-4 gap-2">
                <button type="submit" class="btn btn-success flex-fill shadow-sm">Pay & Confirm Order</button>
                <a href="/cart" class="btn btn-secondary flex-fill">Back to Cart</a>
            </div>
        </form>
    </div>
</div>

<!-- Interactivity -->
<script>
    // Dynamic display of fields based on payment type
    document.getElementById('paymentMethod').addEventListener('change', function() {
        document.getElementById('cardFields').style.display = this.value === 'Card' ? '' : 'none';
        document.getElementById('cryptoFields').style.display = this.value === 'Crypto' ? '' : 'none';
        document.getElementById('bankFields').style.display = this.value === 'BankTransfer' ? '' : 'none';
    });
    window.onload = function() {
        var method = document.getElementById('paymentMethod').value;
        document.getElementById('cardFields').style.display = method === 'Card' ? '' : 'none';
        document.getElementById('cryptoFields').style.display = method === 'Crypto' ? '' : 'none';
        document.getElementById('bankFields').style.display = method === 'BankTransfer' ? '' : 'none';
    };
</script>
</body>
</html>
